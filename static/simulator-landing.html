<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Samplit AI Simulator | Watch Intelligence in Action</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <link href="https://fonts.googleapis.com/css?family=Inter:300,400,600,700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .grid-bg {
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
        }
    </style>

    <!-- âœ… Self-Tracking: Samplit uses Samplit -->
    <script>
        // Minimal tracking stub for the simulator landing
        // In production, this would be the full t.js from CDN
        window.samplit = window.samplit || {
            track: function (event, data) {
                console.log('[Samplit Track]', event, data);
                // POST to our own tracker endpoint
                fetch('/api/v1/tracker/event', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ event, data, timestamp: Date.now() })
                }).catch(() => { });
            }
        };

        // Fire landing_view on load
        document.addEventListener('DOMContentLoaded', () => {
            window.samplit.track('landing_view', { page: 'simulator' });
        });
    </script>
</head>

<body class="bg-slate-50 text-slate-900 overflow-x-hidden" x-data="simulator()">

    <!-- Hero Section -->
    <div class="relative pt-16 pb-12 sm:pt-24 lg:pb-20">
        <div class="mx-auto max-w-7xl px-6 lg:px-8 text-center relative z-10">
            <div
                class="inline-flex items-center rounded-full bg-blue-50 px-3 py-1 text-sm font-medium text-blue-700 ring-1 ring-inset ring-blue-700/10 mb-6">
                <span class="flex w-2 h-2 bg-blue-600 rounded-full animate-pulse mr-2"></span>
                Live Simulation Running
            </div>

            <h1 class="text-4xl font-bold tracking-tight text-slate-900 sm:text-6xl mb-6">
                Watch AI Optimize <span class="text-blue-600">Copywriting</span><br>
                <span class="text-slate-400">in Real-Time</span>
            </h1>

            <p class="mt-6 text-lg leading-8 text-slate-600 max-w-2xl mx-auto">
                See how our Multi-Armed Bandit algorithm (Thompson Sampling) tests 9 different combinations to find the
                highest converting message.
            </p>
        </div>

        <!-- Live Visualizer -->
        <div class="mt-16 bg-white border-y border-slate-200 shadow-sm relative overflow-hidden">
            <div class="mx-auto max-w-7xl px-6 lg:px-8 py-12">

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">

                    <!-- Left: The Simulation Stream -->
                    <div class="space-y-6">
                        <h3 class="text-sm font-semibold text-slate-500 uppercase tracking-wider">Live Traffic Stream
                        </h3>

                        <!-- Event Log -->
                        <div
                            class="h-64 bg-slate-900 rounded-lg p-4 font-mono text-xs text-green-400 overflow-hidden relative">
                            <div
                                class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-slate-900 pointer-events-none z-10">
                            </div>

                            <template x-for="event in events" :key="event.id">
                                <div class="mb-2 flex items-center transition-all duration-300"
                                    :class="{'opacity-100': event.new, 'opacity-50': !event.new}">
                                    <span class="w-16 text-slate-500" x-text="event.time"></span>
                                    <span class="flex-1">
                                        User saw: <span class="text-white" x-text="event.combo"></span>
                                    </span>
                                    <span x-show="event.converted" class="text-yellow-400 font-bold flex items-center">
                                        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path
                                                d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                                            </path>
                                        </svg>
                                        CONVERTED
                                    </span>
                                </div>
                            </template>
                        </div>

                        <div class="flex justify-between text-sm text-slate-500">
                            <span>Visitors: <strong x-text="stats.visitors.toLocaleString()">0</strong></span>
                            <span>Conversions: <strong x-text="stats.conversions.toLocaleString()">0</strong></span>
                        </div>
                    </div>

                    <!-- Right: The Application Stats -->
                    <div class="bg-slate-50 rounded-xl border border-slate-200 p-6">
                        <h3 class="text-lg font-semibold text-slate-900 mb-4">Performance by Variant</h3>

                        <div class="space-y-4">
                            <template x-for="variant in topVariants" :key="variant.name">
                                <div>
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="text-sm font-medium text-slate-700" x-text="variant.name"></span>
                                        <span class="text-sm font-bold" :class="getScoreColor(variant.cr)"
                                            x-text="(variant.cr * 100).toFixed(1) + '%'"></span>
                                    </div>
                                    <div class="w-full bg-slate-200 rounded-full h-2">
                                        <div class="bg-blue-600 h-2 rounded-full transition-all duration-500"
                                            :style="`width: ${(variant.cr * 2000)}%`"></div>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <div class="mt-8 pt-6 border-t border-slate-200">
                            <div class="bg-blue-50 border border-blue-100 rounded-lg p-4 flex items-start gap-3">
                                <div class="p-2 bg-blue-100 rounded-lg">
                                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-blue-900 text-sm">Winning Combination Found</h4>
                                    <p class="text-blue-700 text-xs mt-1">
                                        The algorithm has identified <strong>"Get Started + 10x Conversions"</strong> as
                                        the optimal copy, improving conversion rate by <strong
                                            x-text="improvement">45%</strong>.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- CTA Section -->
        <div class="mx-auto max-w-7xl px-6 lg:px-8 py-20 text-center">
            <h2 class="text-3xl font-bold tracking-tight text-slate-900 sm:text-4xl">
                Ready to optimize your own site?
            </h2>
            <p class="mt-4 text-lg text-slate-600 mb-8">
                Currently in private beta. Join the waitlist for early access.
            </p>

            <form class="max-w-md mx-auto flex gap-x-4" @submit.prevent="submitEmail">
                <label for="email-address" class="sr-only">Email address</label>
                <input id="email-address" name="email" type="email" autocomplete="email" required x-model="email"
                    class="min-w-0 flex-auto rounded-md border-0 px-3.5 py-2 text-slate-900 shadow-sm ring-1 ring-inset ring-slate-300 placeholder:text-slate-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6"
                    placeholder="Enter your email">
                <button type="submit" :disabled="submitting"
                    class="flex-none rounded-md bg-slate-900 px-3.5 py-2.5 text-sm font-medium text-white shadow-sm hover:bg-slate-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-slate-900 disabled:opacity-50">
                    <span x-show="!submitting">Join Waitlist</span>
                    <span x-show="submitting">...</span>
                </button>
            </form>
            <p x-show="submitted" class="mt-4 text-slate-600 font-medium" x-transition>You're on the list. We'll be in
                touch.</p>
        </div>
    </div>

    <script>
        function simulator() {
            return {
                events: [],
                stats: { visitors: 0, conversions: 0 },
                variants: {},
                submitted: false,
                submitting: false,
                email: '',
                improvement: '0%',

                async init() {
                    // 1. Load initial 10k visualization state
                    await this.loadSummary();
                    // 2. Continue simulation (optional, adds life to page)
                    this.startSimulation();
                },

                async loadSummary() {
                    try {
                        const res = await fetch('/api/v1/simulate/summary');
                        const data = await res.json();

                        this.stats.visitors = data.total_visitors;
                        this.stats.conversions = data.total_conversions;
                        this.improvement = (data.improvement * 100).toFixed(0) + '%';

                        data.variants.forEach(v => {
                            this.variants[v.combination] = {
                                visits: v.visits,
                                conv: v.conversions,
                                name: v.name
                            };
                        });
                    } catch (e) { console.error("Summary load failed", e); }
                },

                async startSimulation() {
                    setInterval(async () => {
                        const res = await fetch('/api/v1/simulate/stream');
                        const data = await res.json();

                        data.batch.forEach(e => {
                            this.addEvent(e);
                            this.updateStats(e);
                        });

                    }, 2000); // Fetch batch every 2s
                },

                addEvent(e) {
                    const now = new Date();
                    const time = now.toLocaleTimeString().split(' ')[0];

                    this.events.unshift({
                        id: Math.random(),
                        time: time,
                        combo: e.combination,
                        converted: e.converted,
                        new: true
                    });

                    if (this.events.length > 8) this.events.pop();

                    // Remove 'new' class after animation
                    setTimeout(() => {
                        if (this.events[0]) this.events[0].new = false;
                    }, 500);
                },

                updateStats(e) {
                    this.stats.visitors++;
                    if (e.converted) this.stats.conversions++;

                    if (!this.variants[e.combination]) {
                        this.variants[e.combination] = { visits: 0, conv: 0 };
                    }
                    this.variants[e.combination].visits++;
                    if (e.converted) this.variants[e.combination].conv++;

                    // Calculate improvement (Simulated logic)
                    this.improvement = ((this.stats.conversions / this.stats.visitors) * 1200).toFixed(0) + '%';
                },

                get topVariants() {
                    return Object.entries(this.variants)
                        .map(([name, data]) => ({
                            name,
                            cr: data.visits > 0 ? data.conv / data.visits : 0
                        }))
                        .sort((a, b) => b.cr - a.cr)
                        .slice(0, 4);
                },

                getScoreColor(cr) {
                    if (cr > 0.04) return 'text-green-600';
                    if (cr > 0.03) return 'text-blue-600';
                    return 'text-slate-500';
                },

                submitEmail() {
                    this.submitting = true;

                    // POST to leads API
                    fetch('/api/v1/leads/capture', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            email: this.email,
                            source: 'simulator',
                            variant: null
                        })
                    })
                        .then(res => res.json())
                        .then(data => {
                            this.submitted = true;
                            this.submitting = false;

                            // Track the event
                            if (window.samplit && window.samplit.track) {
                                window.samplit.track('email_submit', { page: 'simulator' });
                            }
                        })
                        .catch(err => {
                            console.error('Lead capture failed:', err);
                            this.submitting = false;
                        });
                }
            }
        }
    </script>
</body>

</html>