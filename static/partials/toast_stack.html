<!-- SOTA: Toast Notification Stack (Global Component) -->
<div x-data="toastManager()" class="fixed bottom-6 right-6 z-[99999] space-y-3 max-w-sm pointer-events-none">
    <template x-for="toast in toasts" :key="toast.id">
        <div x-show="toast.visible" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 translate-y-4 translate-x-4"
            x-transition:enter-end="opacity-100 translate-y-0 translate-x-0"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0 translate-x-8"
            class="pointer-events-auto rounded-2xl border shadow-premium overflow-hidden backdrop-blur-xl" :class="{
                'bg-white border-gray-100 dark:bg-gray-900 dark:border-gray-800': toast.type === 'info',
                'bg-emerald-50 border-emerald-100 dark:bg-emerald-500/10 dark:border-emerald-500/20': toast.type === 'success',
                'bg-red-50 border-red-100 dark:bg-red-500/10 dark:border-red-500/20': toast.type === 'error'
            }">
            <div class="flex items-start gap-4 p-4">
                <div class="flex h-10 w-10 shrink-0 items-center justify-center rounded-xl" :class="{
                        'bg-gray-100 text-gray-500 dark:bg-white/5 dark:text-gray-400': toast.type === 'info',
                        'bg-emerald-100 text-emerald-600 dark:bg-emerald-500/20 dark:text-emerald-400': toast.type === 'success',
                        'bg-red-100 text-red-600 dark:bg-red-500/20 dark:text-red-400': toast.type === 'error'
                    }">
                    <span class="material-symbols-outlined text-xl"
                        x-text="toast.type === 'success' ? 'check_circle' : (toast.type === 'error' ? 'error' : 'info')"></span>
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-bold" :class="{
                            'text-gray-900 dark:text-white': toast.type === 'info',
                            'text-emerald-900 dark:text-emerald-400': toast.type === 'success',
                            'text-red-900 dark:text-red-400': toast.type === 'error'
                        }" x-text="toast.message"></p>
                </div>
                <button @click="removeToast(toast.id)"
                    class="shrink-0 rounded-lg p-1 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 transition-colors">
                    <span class="material-symbols-outlined text-lg">close</span>
                </button>
            </div>
            <!-- Progress Bar (Auto Dismiss) -->
            <div class="h-1 w-full bg-gray-100 dark:bg-white/5">
                <div class="h-full transition-all duration-75 ease-linear" :class="{
                        'bg-gray-400 dark:bg-gray-600': toast.type === 'info',
                        'bg-emerald-500': toast.type === 'success',
                        'bg-red-500': toast.type === 'error'
                    }" :style="`width: ${toast.progress}%`"></div>
            </div>
        </div>
    </template>
</div>

<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('toastManager', () => ({
            toasts: [],
            toastCounter: 0,

            init() {
                // Listen for toast:show events dispatched from anywhere in the app
                window.addEventListener('toast:show', (event) => {
                    this.addToast(event.detail.message, event.detail.type || 'info', event.detail.duration || 4000);
                });
            },

            addToast(message, type = 'info', duration = 4000) {
                const id = ++this.toastCounter;
                const toast = {
                    id,
                    message,
                    type,
                    visible: true,
                    progress: 100
                };
                this.toasts.push(toast);

                // Animate progress bar
                const interval = setInterval(() => {
                    const t = this.toasts.find(t => t.id === id);
                    if (t) {
                        t.progress -= 2;
                        if (t.progress <= 0) {
                            clearInterval(interval);
                            this.removeToast(id);
                        }
                    } else {
                        clearInterval(interval);
                    }
                }, duration / 50);
            },

            removeToast(id) {
                const toast = this.toasts.find(t => t.id === id);
                if (toast) {
                    toast.visible = false;
                    setTimeout(() => {
                        this.toasts = this.toasts.filter(t => t.id !== id);
                    }, 300);
                }
            }
        }));
    });
</script>