<!-- SOTA: Command Palette (Cmd+K) Global Component -->
<div x-data="commandPalette()" x-show="open" x-trap.noscroll="open" @keydown.window.meta.k.prevent="open = true"
    @keydown.window.ctrl.k.prevent="open = true" @keydown.escape.window="open = false"
    class="fixed inset-0 z-[999999] flex items-start justify-center pt-[15vh] px-4" x-cloak>

    <!-- Backdrop -->
    <div x-show="open" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" @click="open = false"
        class="absolute inset-0 bg-gray-900/60 backdrop-blur-sm"></div>

    <!-- Palette Container -->
    <div x-show="open" x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0 scale-95 translate-y-4"
        x-transition:enter-end="opacity-100 scale-100 translate-y-0"
        x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100 scale-100"
        x-transition:leave-end="opacity-0 scale-95 translate-y-4"
        class="relative w-full max-w-xl bg-white dark:bg-gray-900 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-800 overflow-hidden">

        <!-- Search Input -->
        <div class="flex items-center gap-4 px-6 py-4 border-b border-gray-100 dark:border-gray-800">
            <span class="material-symbols-outlined text-2xl text-gray-400">search</span>
            <input type="text" x-model="query" x-ref="searchInput" @input="filterResults()"
                placeholder="Search for pages, actions, or experiments..."
                class="flex-1 bg-transparent text-lg font-medium text-gray-900 dark:text-white placeholder-gray-400 outline-none border-none focus:ring-0">
            <kbd
                class="hidden sm:inline-flex items-center gap-1 px-2 py-1 rounded-lg border border-gray-200 dark:border-gray-700 text-[10px] font-bold text-gray-400 bg-gray-50 dark:bg-gray-800">ESC</kbd>
        </div>

        <!-- Results -->
        <div class="max-h-[320px] overflow-y-auto px-2 py-2">
            <!-- Navigation Section -->
            <div x-show="filteredPages.length > 0" class="mb-2">
                <p class="px-4 py-2 text-[10px] font-black text-gray-400 uppercase tracking-widest">Navigation</p>
                <template x-for="page in filteredPages" :key="page.name">
                    <a :href="page.url"
                        class="flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-gray-50 dark:hover:bg-white/5 transition-colors group">
                        <div
                            class="flex h-10 w-10 items-center justify-center rounded-xl bg-gray-100 dark:bg-white/5 text-gray-500 group-hover:bg-sampelit group-hover:text-white transition-colors">
                            <span class="material-symbols-outlined text-xl" x-text="page.icon"></span>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-bold text-gray-900 dark:text-white" x-text="page.name"></p>
                            <p class="text-xs text-gray-400" x-text="page.description"></p>
                        </div>
                        <span
                            class="material-symbols-outlined text-lg text-gray-300 group-hover:text-sampelit">arrow_forward</span>
                    </a>
                </template>
            </div>

            <!-- Actions Section -->
            <div x-show="filteredActions.length > 0" class="mb-2">
                <p class="px-4 py-2 text-[10px] font-black text-gray-400 uppercase tracking-widest">Quick Actions</p>
                <template x-for="action in filteredActions" :key="action.name">
                    <button @click="action.action()"
                        class="w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-gray-50 dark:hover:bg-white/5 transition-colors group text-left">
                        <div
                            class="flex h-10 w-10 items-center justify-center rounded-xl bg-emerald-50 dark:bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 group-hover:bg-emerald-500 group-hover:text-white transition-colors">
                            <span class="material-symbols-outlined text-xl" x-text="action.icon"></span>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-bold text-gray-900 dark:text-white" x-text="action.name"></p>
                            <p class="text-xs text-gray-400" x-text="action.description"></p>
                        </div>
                    </button>
                </template>
            </div>

            <!-- Empty State -->
            <div x-show="filteredPages.length === 0 && filteredActions.length === 0" class="py-12 text-center">
                <span class="material-symbols-outlined text-4xl text-gray-300 dark:text-gray-700">search_off</span>
                <p class="mt-4 text-sm font-bold text-gray-500">No results found</p>
                <p class="text-xs text-gray-400">Try a different search term</p>
            </div>
        </div>

        <!-- Footer -->
        <div
            class="flex items-center justify-between px-6 py-3 border-t border-gray-100 dark:border-gray-800 bg-gray-50/50 dark:bg-white/[0.02]">
            <div class="flex items-center gap-2 text-[10px] font-bold text-gray-400 uppercase tracking-widest">
                <span class="material-symbols-outlined text-sm">keyboard</span>
                Navigate with arrows
            </div>
            <div class="flex items-center gap-2 text-[10px] font-bold text-gray-400 uppercase tracking-widest">
                <span class="material-symbols-outlined text-sm">keyboard_return</span>
                to select
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('commandPalette', () => ({
            open: false,
            query: '',

            pages: [
                { name: 'Dashboard', url: 'index_v2.html', icon: 'dashboard', description: 'Overview and metrics' },
                { name: 'Experiments', url: 'experiments_v2.html', icon: 'science', description: 'Manage A/B tests' },
                { name: 'Analytics', url: 'analytics_v2.html', icon: 'insights', description: 'Performance insights' },
                { name: 'Billing', url: 'billing_v2.html', icon: 'credit_card', description: 'Subscription and invoices' },
                { name: 'Settings', url: 'settings_v2.html', icon: 'settings', description: 'Account preferences' },
                { name: 'Team', url: 'settings_v2.html', icon: 'group', description: 'Team management' },
            ],

            actions: [
                { name: 'Create Experiment', icon: 'add', description: 'Launch a new A/B test', action: () => window.location.href = 'experiments_create_v2.html' },
                { name: 'Toggle Dark Mode', icon: 'dark_mode', description: 'Switch theme', action: () => document.body.classList.toggle('dark') },
            ],

            filteredPages: [],
            filteredActions: [],

            init() {
                this.filteredPages = this.pages;
                this.filteredActions = this.actions;

                this.$watch('open', (value) => {
                    if (value) {
                        this.$nextTick(() => {
                            this.$refs.searchInput.focus();
                        });
                        this.query = '';
                        this.filterResults();
                    }
                });
            },

            filterResults() {
                const q = this.query.toLowerCase();
                this.filteredPages = this.pages.filter(p =>
                    p.name.toLowerCase().includes(q) ||
                    p.description.toLowerCase().includes(q)
                );
                this.filteredActions = this.actions.filter(a =>
                    a.name.toLowerCase().includes(q) ||
                    a.description.toLowerCase().includes(q)
                );
            }
        }));
    });
</script>